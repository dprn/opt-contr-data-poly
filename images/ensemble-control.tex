% === Styles ===
\tikzset{
    plane/.style={fill=gray!10, draw=black!70, line join=round, fill opacity=0.7},
    sample/.style={circle, fill=#1, inner sep=1.3pt},
    flow/.style={thick, dashed, ->, shorten >=1pt, shorten <=1pt}
}

% === Define plane corners (tilted surfaces) ===
\coordinate (E1) at (-3.5,-1.2,0);
\coordinate (E2) at (-3.5, 1.2,0);
\coordinate (E3) at (-3, 1.2,2);
\coordinate (E4) at (-3,-1.2,2);
\filldraw[plane] (E1)--(E2)--(E3)--(E4)--cycle;

\coordinate (F1) at (3,-1.3,0.3);
\coordinate (F2) at (3, 1.3,0.3);
\coordinate (F3) at (3.5, 1.3,2.3);
\coordinate (F4) at (3.5,-1.3,2.3);
\filldraw[plane] (F1)--(F2)--(F3)--(F4)--cycle;

% === Labels ===
\node[below left] at (E1) {$U$};
\node[below right] at (F1) {$f(U)$};

% === Sample points on E (red) ===
\foreach \i/\y/\z in {1/-0.8/0.3,2/-0.2/0.8,3/0/1.3,4/0.6/1.6,5/0.9/0.9}{
    \node[sample=red] (E\i) at (-3.3,\y,\z) {};
}

% === Corresponding points on f(E) (blue) ===
\foreach \i/\y/\z in {1/-0.8/0.4,2/-0.3/1.0,3/0/1.6,4/0.6/2.0,5/0.9/1.1}{
    \node[sample=blue] (F\i) at (3.3,\y,\z+0.2) {};
}

% === Flows between planes ===
\foreach \i in {1,2,3,4,5}{
    \pgfmathsetmacro{\cx}{0.5*rand}
    \pgfmathsetmacro{\cy}{0.4*rand}
    \pgfmathsetmacro{\cz}{0.6*rand}
    \draw[flow, black!60]
      (E\i) .. controls (0,\cy,\cz) and (0.2,-\cy,1.2*\cz) .. (F\i);
}

% === Highlighted teal trajectories ===
% \foreach \i in {1,3,5}{
%     \pgfmathsetmacro{\cx}{0.6*rand}
%     \pgfmathsetmacro{\cy}{0.3*rand}
%     \pgfmathsetmacro{\cz}{0.5*rand}
%     \draw[flow, teal!60, densely dashed]
%       (E\i) .. controls (0.2,\cy,\cz) and (0.3,-\cy,1.1*\cz) .. (F\i);
% }

% === Labels ===
% \node at (0,2.1,1.2) {$(s, W, b)$};
% \node[red!70!black, font=\small] at (-3.5,1.4,0.6) {$E_{\mathrm{samples}}$};
